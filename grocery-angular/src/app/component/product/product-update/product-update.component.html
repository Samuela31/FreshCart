<div class="container my-5">
  <h2 class="text-center mb-4">Update Product</h2>

  <!-- Enter Product ID to Edit -->
  <div class="mb-4 row g-2 align-items-center">
    <div class="col-auto">
      <input
        type="number"
        class="form-control"
        placeholder="Enter Product ID"
        [(ngModel)]="productIdToEdit"
        name="productIdToEdit"
      />
    </div>
    <div class="col-auto">
      <button class="btn btn-primary" (click)="fetchProduct()">
        Fetch Product
      </button>
    </div>
  </div>

  <!-- Edit Form -->
  <div *ngIf="selectedProduct" class="p-4 border rounded shadow-sm bg-light">
    <form #updateForm="ngForm" (ngSubmit)="onSubmit(updateForm)" novalidate>
      <!-- Product Name -->
      <div class="mb-3">
        <label class="form-label">Product Name</label>
        <input
          type="text"
          class="form-control"
          name="productName"
          [(ngModel)]="selectedProduct.productName"
          required
          minlength="3"
          [ngClass]="{
            'is-invalid': submitted && !selectedProduct.productName
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="submitted && !selectedProduct.productName"
        >
          Product name is required.
        </div>
      </div>

      <!-- Category -->
      <div class="mb-3">
        <label class="form-label">Category</label>
        <select
          class="form-select"
          name="category"
          [(ngModel)]="selectedProduct.category"
          required
          [ngClass]="{ 'is-invalid': submitted && !selectedProduct.category }"
        >
          <option value="" disabled>Select a category</option>
          <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
        </select>
        <div
          class="invalid-feedback"
          *ngIf="submitted && !selectedProduct.category"
        >
          Category is required.
        </div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea
          class="form-control"
          name="description"
          [(ngModel)]="selectedProduct.description"
        ></textarea>
      </div>

      <!-- Price -->
      <div class="mb-3">
        <label class="form-label">Price</label>
        <input
          type="number"
          class="form-control"
          name="price"
          [(ngModel)]="selectedProduct.price"
          required
          min="0.01"
          [ngClass]="{
            'is-invalid':
              submitted &&
              (!selectedProduct.price || selectedProduct.price <= 0)
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="
            submitted && (!selectedProduct.price || selectedProduct.price <= 0)
          "
        >
          Price must be greater than 0.
        </div>
      </div>

      <!-- Quantity -->
      <div class="mb-3">
        <label class="form-label">Quantity</label>
        <input
          type="number"
          class="form-control"
          name="quantity"
          [(ngModel)]="selectedProduct.quantity"
          required
          min="0"
          [ngClass]="{
            'is-invalid':
              submitted &&
              (!selectedProduct.quantity || selectedProduct.quantity < 0)
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="
            submitted &&
            (!selectedProduct.quantity || selectedProduct.quantity < 0)
          "
        >
          Quantity must be at least 0.
        </div>
      </div>

      <!-- Image URL -->
      <div class="mb-3">
        <label class="form-label">Image URL</label>
        <input
          type="text"
          class="form-control"
          name="imageUrl"
          [(ngModel)]="selectedProduct.imageUrl"
          required
          pattern="https?://.+"
          [ngClass]="{ 'is-invalid': submitted && !selectedProduct.imageUrl }"
        />
        <div
          class="invalid-feedback"
          *ngIf="submitted && !selectedProduct.imageUrl"
        >
          Valid image URL is required.
        </div>
      </div>

      <!-- Image Preview -->
      <div *ngIf="selectedProduct.imageUrl" class="text-center mb-3">
        <img
          [src]="selectedProduct.imageUrl"
          alt="Preview"
          class="img-fluid rounded"
          style="max-width: 150px"
        />
      </div>

      <!-- Submit -->
      <button type="submit" class="btn btn-success w-100">
        Update Product
      </button>

      <!-- Alerts -->
      <div *ngIf="successMessage" class="alert alert-success mt-3">
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        {{ errorMessage }}
      </div>
    </form>
  </div>

  <!-- Product Table -->
  <h5>All Products</h5>
  <table class="table table-striped table-bordered mb-4">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Image</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of allProducts">
        <td>{{ p.productId }}</td>
        <td>{{ p.productName }}</td>
        <td>{{ p.category }}</td>
        <td>{{ p.price }}</td>
        <td>{{ p.quantity }}</td>
        <td>
          <img [src]="p.imageUrl" alt="img" style="width: 50px; height: 50px" />
        </td>
      </tr>
    </tbody>
  </table>
</div>
